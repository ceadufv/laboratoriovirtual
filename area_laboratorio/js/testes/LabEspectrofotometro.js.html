<!--
	TODO:
	- Colocar agitador magnetico
	- Bancada de preparo de solucao
-->
<html>
<head>
	<meta charset="utf-8" />
	<script src="../jquery.js"></script>
	<script src="../LabUtils.js"></script>
	<script src="../LabHandler.js"></script>
	<script src="../LabPhmetro.js"></script>
	<script src="LabEspectrofotometro.js"></script>
	<script src="LabEspectrofotometro.class.js"></script>
	<style>
		.on { background-color: #0f0;  }
		.on::after { content: "ON"; }
		.off { background-color: #f00; }
		.off::after { content: "OFF"; }
	</style>
	
	<h1>Espectrofotometro</h1>
	<form method="post" action="#" name="form1" >
		<label for="Lmed">Comprimento de onda médio:</label>		
		<input type="number" name="Lmed" min="190" max="1100">
		<br /><br />
  		<input type="radio" name="rdtipo" id="tipo" value="vidro"/> Cubeta de Vidro <br />
  		<input type="radio" name="rdtipo" id="tipo" value="quartzo"/> Cubeta de Quartzo <br />
  		<h2>Soluções</h2>
        <input type="checkbox" name = "comp" id="azulacido" value="on">Azul ácido
        <br /><br />
        <input type="checkbox" name = "comp" id="azulbasico" value="on">Azul básico
        <br /><br />
        <input type="checkbox" name = "comp" id="violeta" value="on">Violeta de Metila
        <br /><br />
		<input type="button" onclick="validar()" value="OK"></button>
	</form>

	<h2>Lampada</h2>
		<span class="deuterio off"></span> Deuterio <span class="tungstenio off"></span> Tungstenio


	<h2>Medir</h2>
		<button onclick="ligar('deuterio')">Deutério</button>
		<button onclick="ligar('tungstenio')"> Tungstênio </button>
		<button onclick="status(1)"> Abrir </button>
		<button onclick="status(0)"> Fechar </button>
		<br /><br />
		<button onclick="medir()"> Medir </button>



	<script>
/*
espectrofotometro()
	.lampadaTungstenio(true)
	.lampadaDeuterio(false)
	.medirAbsorbancia(
		solucao() // Recebe uma "promessa" para abstrair que eh assincrono
			.adicionar('azulbasico',10)
			.adicionar('azulacido',10)
	).done(function (data) {
		console.log('Absorbancia',data)
	});
*/
	//
	var config = {
		lampada: {
			deuterio: false, tungstenio: false
		},
		status: 0,
		Lmed: 400,
		cubeta: 370
	};

	var comp = {
		azulacido: true,
		azulbásico: false,
		violetademetila: false
	};

	function validar (){
		var Lmed = form1.Lmed.value;
		if (Lmed == "") {
			alert('Preencha o campo com comprimento de onda');
			form1.Lmed.focus();
			return false;
		}
		
		if (Lmed > 1100 || Lmed < 190){
			alert('Insira um valor válido');
			form1.Lmed.focus();
			return false;
		}
		
		config.Lmed = Lmed*1


		if((form1.rdtipo[0].checked == false)&&(form1.rdtipo[1].checked == false)){
			alert('Informe o tipo de cubeta');
    		form1.rdtipo[0].focus();
    		return false;
		}

		if((form1.rdtipo[0].checked == true)&&(form1.rdtipo[1].checked == false)){
    		config.cubeta = 370
		}

		if((form1.rdtipo[0].checked == false)&&(form1.rdtipo[1].checked == true)){
    		config.cubeta = 160
		}

		if((form1.comp[0].checked == false)&&(form1.comp[1].checked == false)&&(form1.comp[2].checked == false)){
			alert('Informe a solucao');
    		form1.comp[0].focus();
    		return false;
		}

		if((form1.comp[0].checked == true)&&(form1.comp[1].checked == false)&&(form1.comp[2].checked == false)){
			comp = {
				azulacido: true,
				azulbásico: false,
				violetademetila: false
			}
		console.log(comp)
		}

		if((form1.comp[0].checked == true)&&(form1.comp[1].checked == true)&&(form1.comp[2].checked == false)){
			comp = {
				azulacido: true,
				azulbásico: true,
				violetademetila: false
			}
		console.log(comp)
		}	

		if((form1.comp[0].checked == true)&&(form1.comp[1].checked == true)&&(form1.comp[2].checked == true)){
			comp = {
				azulacido: true,
				azulbásico: true,
				violetademetila: true
			}
		console.log(comp)
		}	

		if((form1.comp[0].checked == false)&&(form1.comp[1].checked == true)&&(form1.comp[2].checked == false)){
			comp = {
				azulacido: false,
				azulbásico: true,
				violetademetila: false
			}
		console.log(comp)
		}	

		if((form1.comp[0].checked == false)&&(form1.comp[1].checked == true)&&(form1.comp[2].checked == true)){
			comp = {
				azulacido: false,
				azulbásico: true,
				violetademetila: true
			}
		console.log(comp)
		}

		if((form1.comp[0].checked == false)&&(form1.comp[1].checked == false)&&(form1.comp[2].checked == true)){
			comp = {
				azulacido: false,
				azulbásico: false,
				violetademetila: true
			}
		console.log(comp)
		}

		if((form1.comp[0].checked == true)&&(form1.comp[1].checked == false)&&(form1.comp[2].checked == true)){
			comp = {
				azulacido: true,
				azulbásico: false,
				violetademetila: true
			}
		console.log(comp)
		}

	}

	function status(v) { config.status = v; }

	function ligar (objeto){
		switch (objeto) {
			case "deuterio":
				config.lampada.deuterio = !config.lampada.deuterio;
			break;
			case "tungstenio":
				config.lampada.tungstenio = !config.lampada.tungstenio;
			break;
		}

		// 
		$('.deuterio')
			.removeClass('off').removeClass('on')
				.addClass((config.lampada.deuterio)?'on':'off');

		//				
		$('.tungstenio')
			.removeClass('off').removeClass('on')
				.addClass((config.lampada.tungstenio)?'on':'off');

		

	}

	function medir(){

		console.log('Comp', comp);

		var dados = [];

		if (comp.azulacido) dados.push({ id: 'azulacido', volume: 1 });
		if (comp.azulbasico) dados.push({ id: 'azulbasico', volume: 1 });
		if (comp.violetademetila) dados.push({ id: 'violetademetila', volume: 1 });

		solucao(dados).done(function (sol) {
			console.log(config);

			espectrofotometro()
				.lampada('deuterio', config.lampada.deuterio)
				.lampada('tungstenio', config.lampada.tungstenio)
				.status(config.status)
				.comprimentoMedio(config.Lmed)
				.cubeta(config.cubeta)
				.medir(sol).done(function (data) {
					
					var transmitancia = data.Tmed
					var absorbancia = data.Amed
					console.log(transmitancia, absorbancia);

					var mc = LabPhmetro.mc

					for (var t = 0; t < 100; t++){
					 	
					 	console.log(t)// tempo em minutos apos o fechamento da tampa
						var ruido = mc(0.0005) + 0.05*Math.exp(-1*t) + 0.4*Math.exp(-0.5*t) + 0.02*Math.exp(-0.33*t)
						//console.log(ruido)

						var Adisplay = absorbancia + ruido;
						var Tdisplay = transmitancia + Math.pow(10,-ruido);
						console.log(Adisplay, Tdisplay)

					}
				})
		});
	}

	</script>
	
</head>
</html>